# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at

#   http://www.apache.org/licenses/LICENSE-2.0

# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

# tests for copy command

statement ok
create table source_table(col1 integer, col2 varchar) as values (1, 'Foo'), (2, 'Bar');

# create an external parquet file
# TODO figure out how to use a real tempfile name
#statement ok
#COPY source_table to '/tmp/table.parquet';


# create an external parquet file from a query
# TODO figure out how to use a real tempfile name
statement ok
COPY (select col2, sum(col1) from source_table group by col2 order by col2)  to '/tmp/table.parquet';

# Read the data back in
statement ok
CREATE external table new_table STORED as PARQUET LOCATION '/tmp/table.parquet';

# Read the data back in
query IT
select * from new_table;
----
1 Foo
2 Bar

statement ok
drop table new_table;






# TODO add support for reading directly for files without needing to create an external table
# (TODO find ticket)



# TODO test copying to partitioned target (directory)


# TODO test copying with options



# TODO test query source



# TODO: support CSV, JSON and AVRO

# TODO: document different options



statement ok
drop table source_table;
